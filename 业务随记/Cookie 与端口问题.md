同一套前端ERP程序，部署了多个账套。两个账套的协议、ip相同，端口不同。

> http://xxx.xx.x.xxx:8080
> http://xxx.xx.x.xxx:9201

当同一用户在同一浏览器(Chrome)打开这两个不同端口的程序进行操作时,出现表单提交错误、切换程序操作需重新登录等问题。

经排查，发现是出现了Cookie被覆盖的问题。排查过程如下：

- 登录 `8080` 后，获取到 Cookie `beegosessionID=xxxxx1`。此时 `8080` 标签页可与服务端正常通讯。
- 新开一个标签页，登录 `9201` 程序，获取到 Cookie `beegosessionID=xxxxx2`。此时 `9201` 标签页可以与服务端正常通讯。
- 切换到 `8080` 标签页, 此时与后端通讯，请求携带的 Cookie 变成了 `beegosessionID=xxxxx2`。服务端返回错误提示。

前端程序是没有对 Cookie 做任何操作的。说明在第二个标签页即 `9201` 登录后，第一个标签页 `8080` 的 Cookie 被覆盖了。

查找资料后，知道 Cookie 相对于LocalStorage 和 SessionStorage ，是不会对端口做区分的。

[HTTP cookie端口是否特定](https://www.imooc.com/wenda/detail/593744)

> 1.介绍
>
> 由于历史原因，cookie包含许多安全和隐私信息。例如，服务器可以指示给定的cookie用于“安全”连接，但Secure属性在存在活动网络攻击者时不提供完整性。 同样，**给定主机的cookie在该主机上的所有端口之间共享**，即使Web浏览器使用的通常的“同源策略”隔离了通过不同端口检索的内容。
> ...
>
> 8.5 弱机密性
>
> **Cookie不提供端口隔离**。如果cookie在一个端口上运行的服务可读，则cookie也可由在同一服务器的另一个端口上运行的服务读取。如果cookie在一个端口上可由服务写入，则cookie也可由在同一服务器的另一个端口上运行的服务写入。出于这个原因，服务器不应该在同一主机的不同端口上运行相互不信任的服务，并使用cookie来存储安全敏感信息。

> [谷歌] 浏览器安全手册
>
> 默认情况下，cookie范围仅限于当前主机名上的所有URL - 而不是绑定到端口或协议信息。

> 其它
> 在http://localhost:3000和http://localhost:4000之间跳转时，Chrome会传入相同的cookie，每个服务都无法理解cookie并生成新的cookie。
>
> 但如果访问http://localhost:3000和http://127.0.0.1:4000，就不会有问题。因为Chrome浏览器保持一个cookie本地主机，一个用于127.0.0.1